<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è¥¿é©¬è·¯é¡¹ç›® - ç”¨æˆ·æ³¨å†Œ</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <style>
        body { margin: 0; background: #2d3a4b; height: 100vh; display: flex; justify-content: center; align-items: center; }
        .register-card { width: 450px; padding: 30px; background: #fff; border-radius: 6px; }
        .title { text-align: center; font-size: 22px; margin-bottom: 25px; color: #333; font-weight: bold;}
        .captcha-row { display: flex; gap: 10px; }
        .login-link { text-align: right; margin-top: 10px; font-size: 14px; }
        .login-link a { color: #409EFF; text-decoration: none; }
    </style>
</head>
<body>
    <div id="app">
        <div class="register-card">
            <div class="title">ğŸš€ æ–°ç”¨æˆ·æ³¨å†Œ</div>
            <el-form :model="form" :rules="rules" ref="regForm" label-width="80px">

                <el-form-item label="ç”¨æˆ·å" prop="username">
                    <el-input v-model="form.username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å"></el-input>
                </el-form-item>

                <el-form-item label="å¯†ç " prop="password">
                    <el-input v-model="form.password" type="password" placeholder="è®¾ç½®å¯†ç "></el-input>
                </el-form-item>

                <el-form-item label="æ‰‹æœºå·" prop="phone">
                    <el-input v-model="form.phone" placeholder="ç”¨äºæ¥æ”¶ç´§æ€¥é€šçŸ¥"></el-input>
                </el-form-item>

                <el-form-item label="é‚®ç®±" prop="email">
                    <el-input v-model="form.email" placeholder="ç”¨äºæ¥æ”¶éªŒè¯ç "></el-input>
                </el-form-item>

                <el-form-item label="éªŒè¯ç " prop="code">
                    <div class="captcha-row">
                        <el-input v-model="form.code" placeholder="6ä½æ•°å­—"></el-input>
                        <el-button type="primary" :disabled="timer > 0" @click="sendCode">
                            {{ timer > 0 ? timer + 'såé‡å‘' : 'è·å–éªŒè¯ç ' }}
                        </el-button>
                    </div>
                </el-form-item>

                <el-form-item>
                    <el-button type="primary" style="width: 100%" @click="doRegister" :loading="loading">ç«‹å³æ³¨å†Œ</el-button>
                </el-form-item>
            </el-form>
            <div class="login-link">
                å·²æœ‰è´¦å·ï¼Ÿ<a href="login.html">å»ç™»å½•</a>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@2/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
        new Vue({
            el: '#app',
            data: {
                loading: false,
                timer: 0,
                form: {
                    username: '',
                    password: '',
                    phone: '',
                    email: '',
                    code: ''
                },
                rules: {
                    username: [{ required: true, message: 'å¿…å¡«', trigger: 'blur' }],
                    password: [{ required: true, message: 'å¿…å¡«', trigger: 'blur' }],
                    email: [
                        { required: true, message: 'å¿…å¡«', trigger: 'blur' },
                        { type: 'email', message: 'é‚®ç®±æ ¼å¼ä¸å¯¹', trigger: 'blur' }
                    ],
                    code: [{ required: true, message: 'è¯·è¾“å…¥éªŒè¯ç ', trigger: 'blur' }]
                }
            },
            methods: {
                // å‘é€éªŒè¯ç 
                sendCode() {
                    // å…ˆåªæ ¡éªŒé‚®ç®±è¿™ä¸€é¡¹
                    this.$refs.regForm.validateField('email', (err) => {
                        if (!err) {
                            axios.post('/api/auth/send-code?email=' + this.form.email)
                                .then(res => {
                                    if (res.data.code === 200) {
                                        this.$message.success('éªŒè¯ç å·²å‘é€ï¼Œè¯·æŸ¥çœ‹åå°æ§åˆ¶å°ï¼');
                                        this.startTimer();
                                    } else {
                                        this.$message.error(res.data.message);
                                    }
                                });
                        }
                    });
                },
                // å€’è®¡æ—¶é€»è¾‘
                startTimer() {
                    this.timer = 60;
                    const interval = setInterval(() => {
                        this.timer--;
                        if (this.timer <= 0) clearInterval(interval);
                    }, 1000);
                },
                // æäº¤æ³¨å†Œ
                doRegister() {
                    this.$refs.regForm.validate((valid) => {
                        if (valid) {
                            this.loading = true;
                            axios.post('/api/auth/register', this.form)
                                .then(res => {
                                    if (res.data.code === 200) {
                                        this.$message.success('æ³¨å†ŒæˆåŠŸï¼');
                                        setTimeout(() => window.location.href = 'login.html', 1500);
                                    } else {
                                        this.$message.error(res.data.message);
                                    }
                                })
                                .finally(() => this.loading = false);
                        }
                    });
                }
            }
        });
    </script>
</body>
</html>