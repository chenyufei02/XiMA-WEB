<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è¿›åº¦è‡ªåŠ¨ç®¡æ§ç³»ç»Ÿ - ç”¨æˆ·æ³¨å†Œ</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/element-ui/2.15.14/theme-chalk/index.min.css">
    <style>
        body { margin: 0; background: #2d3a4b; height: 100vh; display: flex; justify-content: center; align-items: center; font-family: "Helvetica Neue",Helvetica,"PingFang SC","Hiragino Sans GB","Microsoft YaHei","å¾®è½¯é›…é»‘",Arial,sans-serif; }
        .register-card { width: 450px; padding: 35px 35px 20px; background: #fff; border-radius: 6px; box-shadow: 0 2px 12px 0 rgba(0,0,0,0.1); }
        .title { text-align: center; font-size: 24px; margin-bottom: 30px; color: #333; font-weight: 600;}
        .captcha-row { display: flex; gap: 10px; }
        .login-link { text-align: right; margin-top: 20px; font-size: 14px; }
        .login-link a { color: #409EFF; text-decoration: none; }
    </style>
</head>
<body>
    <div id="app">
        <div class="register-card">
            <div class="title">ğŸš€ æ–°ç”¨æˆ·æ³¨å†Œ</div>
            <el-form :model="form" :rules="rules" ref="regForm" label-width="80px">

                <el-form-item label="ç”¨æˆ·å" prop="username">
                    <el-input v-model="form.username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å"></el-input>
                </el-form-item>

                <el-form-item label="çœŸå®å§“å" prop="realName">
                    <el-input v-model="form.realName" placeholder="ï¼ˆé€‰å¡«ï¼‰è¯·è¾“å…¥æ‚¨çš„ç§°å‘¼"></el-input>
                </el-form-item>

                <el-form-item label="å¯†ç " prop="password">
                    <el-input v-model="form.password" type="password" placeholder="è®¾ç½®å¯†ç "></el-input>
                </el-form-item>

                <el-form-item label="æ‰‹æœºå·" prop="phone">
                    <el-input v-model="form.phone" placeholder="ç”¨äºæ¥æ”¶ç´§æ€¥é€šçŸ¥"></el-input>
                </el-form-item>

                <el-form-item label="é‚®ç®±" prop="email">
                    <el-input v-model="form.email" placeholder="ç”¨äºæ¥æ”¶éªŒè¯ç "></el-input>
                </el-form-item>

                <el-form-item label="éªŒè¯ç " prop="code">
                    <div class="captcha-row">
                        <el-input v-model="form.code" placeholder="6ä½æ•°å­—"></el-input>
                        <el-button type="primary" :disabled="timer > 0" @click="sendCode">
                            {{ timer > 0 ? timer + 'såé‡å‘' : 'è·å–éªŒè¯ç ' }}
                        </el-button>
                    </div>
                </el-form-item>

                <el-form-item>
                    <el-button type="primary" style="width: 100%" @click="doRegister" :loading="loading">ç«‹å³æ³¨å†Œ</el-button>
                </el-form-item>
            </el-form>
            <div class="login-link">
                å·²æœ‰è´¦å·ï¼Ÿ<a href="login.html">å»ç™»å½•</a>
            </div>
        </div>
    </div>

    <script src="https://cdn.staticfile.org/vue/2.6.14/vue.min.js"></script>
    <script src="https://cdn.staticfile.org/element-ui/2.15.14/index.min.js"></script>
    <script src="https://cdn.staticfile.org/axios/1.6.5/axios.min.js"></script>

    <script>
        new Vue({
            el: '#app',
            data: {
                loading: false,
                timer: 0,
                form: {
                    username: '',
                    password: '',
                    realName: '',
                    phone: '',
                    email: '',
                    code: ''
                },
                rules: {
                    username: [{ required: true, message: 'å¿…å¡«', trigger: 'blur' }],
                    password: [{ required: true, message: 'å¿…å¡«', trigger: 'blur' }],
                    email: [
                        { required: true, message: 'å¿…å¡«', trigger: 'blur' },
                        { type: 'email', message: 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®', trigger: 'blur' }
                    ],
                    code: [{ required: true, message: 'è¯·è¾“å…¥éªŒè¯ç ', trigger: 'blur' }]
                }
            },
            methods: {
                // --- å‘é€éªŒè¯ç  ---
                sendCode() {
                    this.$refs.regForm.validateField('email', (errorMessage) => {
                        if (errorMessage) return;

                        axios.post('/api/auth/send-code?email=' + this.form.email)
                            .then(res => {
                                // å®½æ¾åˆ¤æ–­ï¼šçŠ¶æ€ç  200 å³ä¸ºæˆåŠŸ
                                const success = (res.data.status == 200 || res.data.code == 200);
                                if (success) {
                                    this.$message.success(res.data.message || 'éªŒè¯ç å·²å‘é€ï¼');
                                    this.startTimer();
                                } else {
                                    this.$message.error(res.data.message || 'å‘é€å¤±è´¥');
                                }
                            })
                            .catch(err => {
                                this.$message.error("ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°");
                            });
                    });
                },

                // --- å€’è®¡æ—¶ ---
                startTimer() {
                    this.timer = 60; // 60ç§’å†·å´æ—¶é—´ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
                    const interval = setInterval(() => {
                        this.timer--;
                        if (this.timer <= 0) clearInterval(interval);
                    }, 1000);
                },

                // --- æ³¨å†Œ ---
                doRegister() {
                    this.$refs.regForm.validate((valid) => {
                        if (valid) {
                            this.loading = true;
                            axios.post('/api/auth/register', this.form)
                                .then(res => {
                                    console.log("æ³¨å†Œå“åº”:", res.data); // æ–¹ä¾¿è°ƒè¯•çœ‹ç»“æ„

                                    // æ ¸å¿ƒä¿®æ”¹ï¼šç¡®ä¿è¿™é‡Œé€»è¾‘æ­£ç¡®
                                    // åªè¦åç«¯è¿”å› status=200ï¼Œå°±è®¤ä¸ºæ˜¯ç»¿è‰²çš„æˆåŠŸ
                                    const success = (res.data.status == 200 || res.data.code == 200);

                                    if (success) {
                                        this.$message.success({
                                            message: 'ğŸ‰ æ³¨å†ŒæˆåŠŸï¼å³å°†è·³è½¬ç™»å½•é¡µ...',
                                            duration: 1500
                                        });
                                        // å»¶è¿Ÿ 1.5ç§’ åè·³è½¬
                                        setTimeout(() => {
                                            window.location.href = 'login.html';
                                        }, 1500);
                                    } else {
                                        this.$message.error(res.data.message);
                                    }
                                })
                                .catch(e => this.$message.error("æ³¨å†Œè¯·æ±‚å¼‚å¸¸"))
                                .finally(() => this.loading = false);
                        }
                    });
                }
            }
        });
    </script>
</body>
</html>