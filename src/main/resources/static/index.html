<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>XiMA æ™ºèƒ½å»ºé€ æ§åˆ¶å°</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <style>
        /* --- 1. å…¨å±€æ·±è‰²ä¸»é¢˜å®šä¹‰ --- */
        :root {
            --bg-color: #1e1e2d;         /* æ·±è“é»‘èƒŒæ™¯ */
            --sidebar-bg: #151521;       /* ä¾§è¾¹æ èƒŒæ™¯ */
            --card-bg: #2b2b40;          /* å¡ç‰‡èƒŒæ™¯ */
            --text-primary: #e1e1e6;     /* ä¸»æ–‡å­—è‰² */
            --text-secondary: #a2a2b8;   /* æ¬¡æ–‡å­—è‰² */
            --accent-purple: #7367f0;    /* éœ“è™¹ç´« */
            --accent-blue: #00cfe8;      /* éœ“è™¹è“ */
            --accent-green: #28c76f;     /* éœ“è™¹ç»¿ */
            --accent-red: #ea5455;       /* è­¦å‘Šçº¢ */
        }

        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg-color); color: var(--text-primary); overflow: hidden; }

        /* --- 2. å¸ƒå±€ç»“æ„ --- */
        #app { display: flex; height: 100vh; }

        /* ä¾§è¾¹æ  */
        .sidebar { width: 260px; background-color: var(--sidebar-bg); display: flex; flex-direction: column; border-right: 1px solid rgba(255,255,255,0.05); }
        .logo-area { height: 80px; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: bold; color: white; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .logo-area i { color: var(--accent-purple); margin-right: 10px; font-size: 24px; }

        /* ä¾§è¾¹èœå•é¡¹ */
        .nav-menu { flex: 1; padding: 20px; }
        .nav-item { display: flex; align-items: center; padding: 12px 20px; margin-bottom: 10px; border-radius: 8px; color: var(--text-secondary); cursor: pointer; transition: all 0.3s; }
        .nav-item:hover, .nav-item.active { background: linear-gradient(90deg, rgba(115, 103, 240, 0.25), transparent); color: var(--accent-purple); border-left: 3px solid var(--accent-purple); }
        .nav-item i { margin-right: 12px; font-size: 18px; }

        /* ä¸»å†…å®¹åŒº */
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }

        /* é¡¶éƒ¨ Header */
        .top-header { height: 70px; display: flex; justify-content: space-between; align-items: center; padding: 0 40px; background-color: var(--bg-color); }
        .page-title h2 { margin: 0; font-size: 24px; font-weight: 600; }
        .user-profile { display: flex; align-items: center; gap: 15px; }
        .avatar { width: 40px; height: 40px; background: linear-gradient(45deg, var(--accent-purple), var(--accent-blue)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; }

        /* æ»šåŠ¨å†…å®¹åŒº */
        .content-scroll { flex: 1; overflow-y: auto; padding: 30px 40px; }

        /* --- 3. æ•°æ®çœ‹æ¿å¡ç‰‡ (ä»¿å›¾ç‰‡é£æ ¼) --- */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; }

        .project-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid rgba(255,255,255,0.05);
            position: relative;
            overflow: hidden;
        }
        .project-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.3); border-color: rgba(115, 103, 240, 0.3); }

        /* å¡ç‰‡å·¦ä¾§çš„å½©è‰²æ¡ */
        .card-stripe { position: absolute; left: 0; top: 15px; bottom: 15px; width: 4px; border-radius: 0 4px 4px 0; }
        .stripe-blue { background: var(--accent-blue); }
        .stripe-purple { background: var(--accent-purple); }
        .stripe-green { background: var(--accent-green); }

        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-left: 10px; }
        .p-title { font-size: 18px; font-weight: bold; color: #fff; }
        .p-status { font-size: 12px; padding: 4px 10px; border-radius: 12px; background: rgba(40, 199, 111, 0.15); color: var(--accent-green); }

        .p-info { font-size: 13px; color: var(--text-secondary); margin-bottom: 20px; padding-left: 10px; line-height: 1.6; }

        /* è¿›åº¦æ¡ */
        .progress-mini { height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; margin: 15px 0 25px 10px; overflow: hidden; }
        .progress-bar { height: 100%; border-radius: 3px; background: linear-gradient(90deg, var(--accent-purple), var(--accent-blue)); }

        /* åº•éƒ¨æŒ‰é’®ç»„ - é‡ç‚¹ï¼ */
        .action-buttons { display: flex; gap: 10px; padding-left: 10px; }
        .btn-neon {
            flex: 1;
            border: none;
            padding: 8px 0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            color: white;
            transition: all 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 5px;
        }
        .btn-map { background: rgba(115, 103, 240, 0.15); color: var(--accent-purple); }
        .btn-map:hover { background: var(--accent-purple); color: white; }

        .btn-floor { background: rgba(0, 207, 232, 0.15); color: var(--accent-blue); }
        .btn-floor:hover { background: var(--accent-blue); color: white; }

        .btn-chart { background: rgba(40, 199, 111, 0.15); color: var(--accent-green); }
        .btn-chart:hover { background: var(--accent-green); color: white; }

        /* é¡¶éƒ¨ç»Ÿè®¡å¡ç‰‡ */
        .stats-row { display: flex; gap: 20px; margin-bottom: 30px; }
        .stat-card { flex: 1; background: var(--card-bg); padding: 20px; border-radius: 12px; display: flex; align-items: center; gap: 20px; }
        .stat-icon { width: 50px; height: 50px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px; }

        /* è¦†ç›– Element UI çš„é»˜è®¤æ ·å¼ */
        .el-button--primary { background: linear-gradient(45deg, var(--accent-purple), var(--accent-blue)); border: none; }
        .el-button--primary:hover { opacity: 0.9; }
        .el-loading-mask { background-color: rgba(30, 30, 45, 0.8); }
    </style>
</head>
<body>

<div id="app">
    <div class="sidebar">
        <div class="logo-area">
            <i class="el-icon-monitor"></i> XiMA æ™ºé€ 
        </div>
        <div class="nav-menu">
            <div class="nav-item active">
                <i class="el-icon-menu"></i> é¡¹ç›®æ¦‚è§ˆ
            </div>
            <div class="nav-item" @click="goToImport">
                <i class="el-icon-upload"></i> é¡¹ç›®å¯¼å…¥
            </div>
            <div class="nav-item">
                <i class="el-icon-setting"></i> ç³»ç»Ÿè®¾ç½®
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="top-header">
            <div class="page-title">
                <h2>é¡¹ç›®æ§åˆ¶å°</h2>
            </div>
            <div class="user-profile">
                <el-button type="primary" size="small" icon="el-icon-plus" round @click="goToImport">æ–°å»ºé¡¹ç›®</el-button>
                <div style="text-align: right; margin-right: 10px;">
                    <div style="font-weight: bold;">{{ username }}</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">ç®¡ç†å‘˜</div>
                </div>
                <div class="avatar">{{ username.substring(0,1).toUpperCase() }}</div>
                <i class="el-icon-switch-button" style="cursor: pointer; color: var(--accent-red); font-size: 20px;" @click="logout" title="é€€å‡º"></i>
            </div>
        </div>

        <div class="content-scroll">

            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(115, 103, 240, 0.2); color: var(--accent-purple);">
                        <i class="el-icon-folder-opened"></i>
                    </div>
                    <div>
                        <div style="font-size: 24px; font-weight: bold;">{{ projects.length }}</div>
                        <div style="color: var(--text-secondary);">è¿›è¡Œä¸­é¡¹ç›®</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(0, 207, 232, 0.2); color: var(--accent-blue);">
                        <i class="el-icon-data-line"></i>
                    </div>
                    <div>
                        <div style="font-size: 24px; font-weight: bold;">98%</div>
                        <div style="color: var(--text-secondary);">è®¡ç®—å‡†ç¡®ç‡</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(40, 199, 111, 0.2); color: var(--accent-green);">
                        <i class="el-icon-cpu"></i>
                    </div>
                    <div>
                        <div style="font-size: 24px; font-weight: bold;">Running</div>
                        <div style="color: var(--text-secondary);">ç³»ç»ŸçŠ¶æ€</div>
                    </div>
                </div>
            </div>

            <h3 style="margin-bottom: 20px; color: var(--text-primary);">æˆ‘çš„é¡¹ç›®åˆ—è¡¨</h3>

            <div v-if="loading" style="text-align: center; padding: 50px;">
                <i class="el-icon-loading" style="font-size: 30px; color: var(--accent-purple);"></i>
                <p style="color: var(--text-secondary);">åŠ è½½æ˜Ÿé™…æ•°æ®ä¸­...</p>
            </div>

            <div class="dashboard-grid" v-else>
                <div class="project-card" v-for="(item, index) in projects" :key="item.id">
                    <div :class="['card-stripe', getStripeColor(index)]"></div>

                    <div class="card-header">
                        <div class="p-title">{{ item.projectName }}</div>
                        <span class="p-status">è¿›è¡Œä¸­</span>
                    </div>

                    <div class="p-info">
                        <div>ğŸ“… {{ formatDate(item.createdAt) }}</div>
                        <div>ğŸ“‚ å…³é”®è¯: {{ item.photoFolderKeyword }}</div>
                    </div>

                    <div class="progress-mini">
                        <div class="progress-bar" :style="{width: Math.floor(Math.random() * 40 + 30) + '%'}"></div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn-neon btn-map" @click="enterFunction('boundary', item.id)">
                            <i class="el-icon-map-location"></i> å›´æ 
                        </button>
                        <button class="btn-neon btn-floor" @click="enterFunction('floor', item.id)">
                            <i class="el-icon-office-building"></i> æ¥¼å±‚
                        </button>
                        <button class="btn-neon btn-chart" @click="enterFunction('chart', item.id)">
                            <i class="el-icon-data-analysis"></i> çœ‹æ¿
                        </button>
                    </div>
                </div>
            </div>

            <div v-if="!loading && projects.length === 0" style="text-align: center; margin-top: 50px; color: var(--text-secondary);">
                <i class="el-icon-folder" style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;"></i>
                <p>æš‚æ— é¡¹ç›®ï¼Œè¯·ç‚¹å‡»å³ä¸Šè§’å¯¼å…¥</p>
            </div>

        </div>
    </div>
</div>

<script src="https://unpkg.com/vue@2/dist/vue.js"></script>
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script>
    new Vue({
        el: '#app',
        data: {
            username: '',
            loading: true,
            projects: []
        },
        created() {
            this.checkLogin();
            this.fetchProjects();
        },
        methods: {
            // ç”Ÿæˆéšæœºé¢œè‰²æ¡ï¼Œçº¯ä¸ºäº†å¥½çœ‹
            getStripeColor(index) {
                const colors = ['stripe-purple', 'stripe-blue', 'stripe-green'];
                return colors[index % 3];
            },

            checkLogin() {
                const token = localStorage.getItem('token');
                const user = localStorage.getItem('username');
                if (!token) {
                    window.location.href = 'login.html';
                    return;
                }
                this.username = user || 'Admin';
            },

            fetchProjects() {
                const token = localStorage.getItem('token');
                axios.get('/api/projects/my', {
                    headers: { 'Authorization': 'Bearer ' + token }
                }).then(res => {
                    if (res.data.status === 200 || res.data.code === 200) {
                        this.projects = res.data.data;
                    }
                }).finally(() => {
                    this.loading = false;
                });
            },

            // ğŸš€ æ ¸å¿ƒè·³è½¬é€»è¾‘
            enterFunction(type, projectId) {
                // 1. è®°å½•å½“å‰é€‰ä¸­çš„é¡¹ç›®IDï¼Œæ–¹ä¾¿å­é¡µé¢è·å–
                localStorage.setItem('currentProjectId', projectId);

                // 2. è·¯ç”±è·³è½¬
                if (type === 'boundary') {
                    window.location.href = 'boundary.html';
                } else if (type === 'floor') {
                    window.location.href = 'floor-config.html';
                } else if (type === 'chart') {
                    window.location.href = 'chart.html';
                }
            },

            goToImport() {
                window.location.href = 'import.html';
            },

            logout() {
                localStorage.removeItem('token');
                window.location.href = 'login.html';
            },

            formatDate(str) {
                return str ? str.split('T')[0] : 'æœªçŸ¥æ—¥æœŸ';
            }
        }
    })
</script>
</body>
</html>